<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Server Tutorial</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Reveal.js CDN -->
	<link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/white.css">
</head>
<body>
				<div style="position: fixed; top: 10px; right: 20px; z-index: 9999; font-family: sans-serif;">
					<label id="lang-label" for="lang-select" style="font-weight: bold; margin-right: 8px;">Language:</label>
					<select id="lang-select" style="padding: 6px 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 1em; background: #fff;">
						<option value="en">üá∫üá∏ English</option>
						<option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
					</select>
				</div>

				<div class="reveal">
					<div class="slides" id="slides-root">
						<!-- Slides will be dynamically generated here -->
					</div>
				</div>
				<section id="score-slide">
					<h2>
						<span class="lang-en">Your Score</span>
						<span class="lang-ja" style="display:none;">„ÅÇ„Å™„Åü„ÅÆ„Çπ„Ç≥„Ç¢</span>
					</h2>
					<div id="quiz-result" style="margin-top:20px; font-weight:bold; font-size:1.2em;"></div>
				</section>
			</div>
		</div>
					<script src="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.min.js"></script>
					   <script>
						   document.addEventListener('DOMContentLoaded', function() {
							   // Load content.json and build slides
							   fetch('content.json')
								   .then(response => response.json())
								   .then(data => {
									   const slidesRoot = document.getElementById('slides-root');
									   // Build slides
									   data.slides.forEach((slide, idx) => {
										   const section = document.createElement('section');
										   const h = document.createElement(idx === 0 ? 'h2' : 'h3');
										   h.innerHTML = `<span class="lang-en">${slide.title.en}</span><span class="lang-ja" style="display:none;">${slide.title.ja}</span>`;
										   section.appendChild(h);
										   slide.bullets.forEach(bullet => {
											   const p = document.createElement('p');
											   p.className = 'fragment';
											   p.innerHTML = `&bull; <span class="lang-en">${bullet.en}</span><span class="lang-ja" style="display:none;">${bullet.ja}</span>`;
											   section.appendChild(p);
										   });
										   slidesRoot.appendChild(section);
									   });

                                       /*
									   // Quiz intro slide
									   const quizIntro = document.createElement('section');
									   quizIntro.innerHTML = `<h3><span class="lang-en">Quiz: Test Your Knowledge</span><span class="lang-ja" style="display:none;">„ÇØ„Ç§„Ç∫ÔºöÁü•Ë≠ò„Çí„ÉÜ„Çπ„Éà„Åó„Åæ„Åó„Çá„ÅÜ</span></h3>`;
									   slidesRoot.appendChild(quizIntro);
									   // Quiz question slides
									   data.quiz.forEach((q, i) => {
										const section = document.createElement('section');
										const div = document.createElement('div');
										div.className = 'quiz-question';
										// Question is always visible, not a fragment
										div.innerHTML = `<p><span class="lang-en">${i+1}. ${q.question.en}</span><span class="lang-ja" style="display:none;">${i+1}. ${q.question.ja}</span></p>`;
										// Choices (all at once)
										q.choices.forEach((choice, j) => {
											div.innerHTML += `<label><span class="lang-en"><input type="radio" name="q${i+1}" value="${String.fromCharCode(97+j)}" class="quiz-choice"> ${choice.en}</span><span class="lang-ja" style="display:none;"><input type="radio" name="q${i+1}" value="${String.fromCharCode(97+j)}" class="quiz-choice"> ${choice.ja}</span></label>`;
										});
										// Add Next button for all but last question
										if (i < data.quiz.length - 1) {
											const nextBtn = document.createElement('button');
											nextBtn.type = 'button';
											nextBtn.className = 'quiz-next';
											nextBtn.style = 'margin-top:20px; padding:8px 16px; font-size:1em; background:#e0e7ff; color:#222; border-radius:8px; border:none; font-weight:600;';
											nextBtn.innerHTML = `<span class="lang-en">Next</span><span class="lang-ja" style="display:none;">Ê¨°„Å∏</span>`;
											div.appendChild(nextBtn);
										}
										// Add submit button on last question
										if (i === data.quiz.length - 1) {
											const btn = document.createElement('button');
											btn.type = 'button';
											btn.id = 'quiz-submit';
											btn.style = 'margin-top:20px; padding:8px 16px; font-size:1em;';
											btn.innerHTML = `<span class="lang-en">Submit Quiz</span><span class="lang-ja" style="display:none;">„ÇØ„Ç§„Ç∫„ÇíÊèêÂá∫</span>`;
											div.appendChild(btn);
										}
										section.appendChild(div);
										slidesRoot.appendChild(section);
									   });
									   // Score slide
									   const scoreSection = document.createElement('section');
									   scoreSection.id = 'score-slide';
									   scoreSection.innerHTML = `<h2><span class="lang-en">Your Score</span><span class="lang-ja" style="display:none;">„ÅÇ„Å™„Åü„ÅÆ„Çπ„Ç≥„Ç¢</span></h2><div id="quiz-result" style="margin-top:20px; font-weight:bold; font-size:1.2em;"></div>`;
									   slidesRoot.appendChild(scoreSection);
                                        */

                                        // Initialize Reveal.js after slides are built
									   if (window.Reveal && Reveal.initialize) {
										   Reveal.initialize();
									   }
									   // Language logic
									   function setLanguage(lang) {
										   document.querySelectorAll('.lang-en').forEach(e => e.style.display = (lang === 'en' ? '' : 'none'));
										   document.querySelectorAll('.lang-ja').forEach(e => e.style.display = (lang === 'ja' ? '' : 'none'));
										   var label = document.getElementById('lang-label');
										   label.textContent = (lang === 'en') ? 'Language:' : 'Ë®ÄË™ûÔºö';
										   // Only apply fragments to tutorial bullets, not quiz questions
										   document.querySelectorAll('.fragment').forEach(e => e.classList.remove('fragment'));
										   // Add fragment class only to tutorial slide bullets
										   document.querySelectorAll('.slides > section').forEach(section => {
											   if (!section.querySelector('.quiz-question')) {
												   section.querySelectorAll('p').forEach(p => p.classList.add('fragment'));
											   }
										   });
										   if (window.Reveal && Reveal.sync) Reveal.sync();
									   }
									   document.getElementById('lang-select').onchange = function() {
										   setLanguage(this.value);
									   };
									   setLanguage('en');

									   // Quiz grading logic
									   // Attach submit button event directly after building slides
									   setTimeout(function() {
										var slidesRoot = document.getElementById('slides-root');
										if (slidesRoot) {
											document.addEventListener('click', function(event) {
												// Next button logic
												if (event.target && event.target.classList.contains('quiz-next')) {
													event.preventDefault();
													if (window.Reveal && Reveal.next) {
														Reveal.next();
													}
												}
												// Auto-advance on choice selection
												if (event.target && event.target.classList.contains('quiz-choice')) {
													// Only auto-advance if not last question
													const currentSection = event.target.closest('section');
													if (currentSection && !currentSection.querySelector('#quiz-submit')) {
														setTimeout(function() {
															if (window.Reveal && Reveal.next) {
																Reveal.next();
															}
														}, 150);
													}
												}
												// Submit button logic
												if (event.target && event.target.id === 'quiz-submit') {
													event.preventDefault();
													let score = 0;
													data.quiz.forEach((q, i) => {
														const qName = 'q' + (i+1);
														const selected = document.querySelector('input[name="' + qName + '"]:checked');
														if (selected && (selected.value.charCodeAt(0) - 97) === q.answer) score++;
													});
													const percent = Math.round((score/data.quiz.length)*100);
													let grade = '';
													if (percent >= 90) grade = 'A';
													else if (percent >= 80) grade = 'B';
													else if (percent >= 70) grade = 'C';
													else if (percent >= 60) grade = 'D';
													else grade = 'F';
													const lang = document.getElementById('lang-select').value;
													let resultText = '';
													if (lang === 'ja') {
														resultText = `„Çπ„Ç≥„Ç¢: ${score}/${data.quiz.length} (${percent}%) ‚Äî Ë©ï‰æ°: ${grade}`;
													} else {
														resultText = `Score: ${score}/${data.quiz.length} (${percent}%) ‚Äî Grade: ${grade}`;
													}
													// Go to score slide first, then update score
													if (window.Reveal && Reveal.slide) {
														const slides = document.querySelectorAll('.slides > section');
														let scoreIndex = -1;
														slides.forEach((s, i) => {
															if (s.id === 'score-slide') scoreIndex = i;
														});
														if (scoreIndex !== -1) {
															Reveal.slide(scoreIndex);
															setTimeout(function() {
																document.getElementById('quiz-result').textContent = resultText;
															}, 300);
														} else {
															document.getElementById('quiz-result').textContent = resultText;
														}
													} else {
														document.getElementById('quiz-result').textContent = resultText;
													}
												}
											});
										}
									   }, 400);
								   });
						   });
					</script>
</body>
</html>
